<h3>Food Trucks Near You...</h3>
   <div id="map"></div>
    <script>
        function showMap() {

          // Trying to load the map starting at Lighthouse Labs loacation, then doing geolocation, then adding pins.... Doesn't seem to be helping... so I'm commenting this out.

          // var mapDiv = document.getElementById('map');
          // var map = new google.maps.Map(mapDiv, {
          //   center: {
          //       lat: 43.644645,
          //       lng: -79.394999
          //   },
          //   zoom: 13
          // });

          getLocation();
        }


        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                buildMap(pos);
            });
          }

        }

        function buildMap(pos){

          var mapDiv = document.getElementById('map');
          var map = new google.maps.Map(mapDiv, {
            center: {
                lat: pos["lat"],
                lng: pos["lng"]
            },
            zoom: 13
          });

          var your_marker = new google.maps.Marker({
            position: pos,
            title: "You!"
          });

          // To add the marker to the map, call setMap();
          your_marker.setMap(map);

          <% 
          trucks = []
          @stops.each_with_index do |stop,index| 
            trucks << [stop.name,stop.latitude,stop.longitude,index]
          end 
          %>

          var trucks = <%= pp trucks %>;

          var image = {
              url: 'http://localhost:3000/images/truck.png',
            
              size: new google.maps.Size(30, 20),
              // The origin for this image is (0, 0).
              origin: new google.maps.Point(0, 0),
              // The anchor for this image is the base of the flagpole at (0, 32).
              anchor: new google.maps.Point(0, 32)
          };
          // Shapes define the clickable region of the icon. The type defines an HTML
          // <area> element 'poly' which traces out a polygon as a series of X,Y points.
          // The final coordinate closes the poly by connecting to the first coordinate.
          var shape = {
              coords: [1, 1, 1, 20, 18, 20, 18, 1],
              type: 'poly'
          };

          for (var i = 1; i < trucks.length; i++) {
              var truck = trucks[i];

              var marker = new google.maps.Marker({
                  position: {
                      lat: truck[1],
                      lng: truck[2]
                  },
                  map: map,
                  icon: image,
                  shape: shape,
                  title: truck[0],
                  zIndex: truck[3]
              });

              console.log(truck[0]);

              // Create the info window
              var infowindow = new google.maps.InfoWindow({
                content: "<strong style='padding-left: 3px; position:relative; top: 3px'>"+truck[0]+"</strong>"
              });

              // Add event listener for click
              google.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map,marker);
              });
            }


        }
    </script>
    
    <div id="front-page-stops" class="clearfix">
    <% @stops.each do |stop| %>
      <%= erb :'_stop', locals: {stop: stop}   %>
    <% end %>
    </div>