   <div id="map"></div>
    <script>

        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                buildMap(pos);
            });
          }
        }

        function buildMap(pos){

          var mapDiv = document.getElementById('map');
          var map = new google.maps.Map(mapDiv, {
            center: {
                lat: pos["lat"],
                lng: pos["lng"]
            },
            zoom: 12
          });

          var your_marker = new google.maps.Marker({
            position: pos,
            title: "You!"
          });

          // To add the marker to the map, call setMap();
          your_marker.setMap(map);

          <% 
          trucks = []
          @stops.each_with_index do |stop,index| 
            trucks << [stop.name,stop.latitude,stop.longitude,index]
          end 
          %>

          var trucks = <%= pp trucks %>;

          var image = {
              url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
              // This marker is 20 pixels wide by 32 pixels high.
              size: new google.maps.Size(20, 32),
              // The origin for this image is (0, 0).
              origin: new google.maps.Point(0, 0),
              // The anchor for this image is the base of the flagpole at (0, 32).
              anchor: new google.maps.Point(0, 32)
          };
          // Shapes define the clickable region of the icon. The type defines an HTML
          // <area> element 'poly' which traces out a polygon as a series of X,Y points.
          // The final coordinate closes the poly by connecting to the first coordinate.
          var shape = {
              coords: [1, 1, 1, 20, 18, 20, 18, 1],
              type: 'poly'
          };



          for (var i = 1; i < trucks.length; i++) {
              var truck = trucks[i];
              console.log(truck[1]);
              console.log(truck[2]);
              console.log(truck[3]);
              console.log(truck[0]);
              console.log("---------------------");

              var marker = new google.maps.Marker({
                  position: {
                      lat: truck[1],
                      lng: truck[2]
                  },
                  map: map,
                  icon: image,
                  shape: shape,
                  title: truck[0],
                  zIndex: truck[3]
              });
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD6HG1oUyhnLkfe3sAIXX96gJGggtGK-qA&callback=getLocation" async defer></script>